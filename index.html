---
layout: default
---

<div class="posts">
  {% for post in site.posts %}
    {% comment %} 提取文章中的第一张图片 {% endcomment %}
    {% assign first_image = nil %}
    {% assign content_text = post.content %}
    
    {% comment %} 尝试匹配 Markdown 图片格式: ![alt](url) {% endcomment %}
    {% assign image_matches = content_text | split: '![' %}
    {% if image_matches.size > 1 %}
      {% for match in image_matches offset: 1 %}
        {% assign url_part = match | split: '](' %}
        {% if url_part.size > 1 %}
          {% assign image_url = url_part[1] | split: ')' | first | split: '"' | first | strip %}
          {% if image_url != '' and image_url != nil %}
            {% comment %} 处理路径中的反斜杠 {% endcomment %}
            {% assign image_url = image_url | replace: '\', '/' %}
            {% comment %} 处理 site.baseurl 变量（Liquid 变量在内容中会以字符串形式存在）{% endcomment %}
            {% if image_url contains '{{ site.baseurl }}' %}
              {% assign image_url = image_url | replace: '{{ site.baseurl }}', site.baseurl %}
            {% elsif image_url contains 'site.baseurl' %}
              {% assign image_url = image_url | replace: 'site.baseurl', site.baseurl %}
            {% endif %}
            {% comment %} 处理相对路径 {% endcomment %}
            {% unless image_url contains 'http://' or image_url contains 'https://' %}
              {% comment %} 如果路径以 / 开头，直接添加 baseurl {% endcomment %}
              {% assign first_char = image_url | slice: 0 %}
              {% if first_char == '/' %}
                {% assign image_url = site.baseurl | append: image_url %}
              {% elsif image_url contains '/images/' or image_url contains '/uploads/' %}
                {% assign image_url = site.baseurl | append: '/' | append: image_url %}
              {% elsif image_url contains '/' %}
                {% assign image_url = site.baseurl | append: '/' | append: image_url %}
              {% else %}
                {% assign image_url = site.baseurl | append: '/images/' | append: image_url %}
              {% endif %}
            {% endunless %}
            {% assign first_image = image_url %}
            {% break %}
          {% endif %}
        {% endif %}
      {% endfor %}
    {% endif %}
    
    <article class="post">
      <div class="post-content-wrapper">
        <div class="post-content">
          <h1><a href="{{ site.baseurl }}{{ post.url }}">{{ post.title }}</a></h1>

          <div class="post-meta">
            <span class="post-date">
              <time datetime="{{ post.date | date_to_xmlschema }}">{{ post.date | date: "%Y年%m月%d日" }}</time>
            </span>
            <div class="post-meta-right">
              {% if post.tags.size > 0 %}
              <span class="post-tags">
                {% for tag in post.tags %}
                  <a href="{{ site.baseurl }}/tags/#{{ tag | slugify }}" class="tag">#{{ tag }}</a>
                {% endfor %}
              </span>
              {% endif %}
              {% assign words = post.content | number_of_words %}
              {% if words < 360 %}
                <span class="reading-time">1 分钟阅读</span>
              {% else %}
                <span class="reading-time">{{ words | divided_by: 180 }} 分钟阅读</span>
              {% endif %}
            </div>
          </div>

          <div class="entry">
            {{ post.excerpt }}
          </div>

          <a href="{{ site.baseurl }}{{ post.url }}" class="read-more">阅读全文</a>
        </div>
        
        {% if first_image %}
        <div class="post-image-preview">
          <a href="{{ site.baseurl }}{{ post.url }}">
            <img src="{{ first_image }}" alt="{{ post.title }}" loading="lazy" />
          </a>
        </div>
        {% endif %}
      </div>
    </article>
  {% endfor %}
</div>